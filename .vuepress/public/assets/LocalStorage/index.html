<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LocalStorage</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 150px auto;
        background-color: antiquewhite;
      }
      .wrapper {
        padding: 20px;
        max-width: 550px;
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 0 0 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        text-align: center;
        margin: 0;
        font-weight: 200;
      }

      .plates {
        margin: 0;
        padding: 0;
        text-align: left;
        list-style: none;
      }

      .plates li {
        border-bottom: 1px solid rgba(0, 0, 0, 0.2);
        padding: 10px 0;
        font-weight: 100;
        display: flex;
      }

      .plates label {
        flex: 1;
        cursor: pointer;
      }

      .plates input {
        display: none;
      }

      .plates input + label:before {
        content: "â¬œï¸";
        margin-right: 10px;
      }

      .plates input:checked + label:before {
        content: "ğŸŒ®";
      }

      .add-items {
        margin-top: 20px;
      }
      .add-items input:nth-child(1) {
        width: 94%;
        padding: 10px;
        outline: 0;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      .add-items input:nth-child(2) {
        width: 49%;
        padding: 10px;
        outline: 0;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      button {
        width: 49%;
        margin: 5px auto 0;
        padding: 10px;
        outline: 0;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <h2>
        A small demo - LocalStorage <br />
        by Yao Zongbin
      </h2>
      <p></p>
      <ul class="plates">
        <li>æ­£åœ¨åŠ è½½å¾…åŠé¡¹...</li>
      </ul>
      <form class="add-items">
        <input type="text" name="item" placeholder="é¡¹ç›®åç§°" required />
        <input type="submit" value="+ æ·»åŠ å¾…åŠé¡¹" />

        <button onclick="clearLocalStorage()">æ¸…é™¤LocalStorageåˆ—è¡¨</button>
      </form>
    </div>
  </body>
  <script>
    const addItems = document.querySelector(".add-items");
    const itemsList = document.querySelector(".plates");
    const items = JSON.parse(localStorage.getItem("items")) || []; // æœ¬åœ°å­˜å‚¨ä¸­è·å–åä¸ºitemsçš„æ•°æ®ï¼Œå¹¶å°†å…¶è§£æä¸ºJavaScriptå¯¹è±¡

    // æ·»åŠ å¾…åŠäº‹é¡¹å‡½æ•°
    function addItem(e) {
      e.preventDefault();
      const text = this.querySelector("[name=item]").value;
      const item = {
        text,
        done: false,
      };

      items.push(item);
      populateList(items, itemsList);
      localStorage.setItem("items", JSON.stringify(items));
      this.reset(); // é‡ç½®è¡¨å•çš„æ‰€æœ‰è¾“å…¥å­—æ®µä¸ºå®ƒä»¬çš„åˆå§‹å€¼
    }

    // å¡«å……åˆ—è¡¨å‡½æ•°
    function populateList(plates = [], platesList) {
      platesList.innerHTML = plates
        .map((plate, i) => {
          return `
        <li>
          <input type="checkbox" data-index=${i} id="item${i}" ${
            plate.done ? "checked" : ""
          } />
          <label for="item${i}">${plate.text}</label>
        </li>
      `;
        })
        .join("");
    }

    // åˆ‡æ¢å¾…åŠäº‹é¡¹å®ŒæˆçŠ¶æ€çš„å‡½æ•°
    function toggleDone(e) {
      if (!e.target.matches("input")) return; // æ£€æŸ¥äº‹ä»¶ç›®æ ‡æ˜¯å¦æ˜¯ä¸€ä¸ªinputå…ƒç´ 
      const el = e.target; // è§¦å‘äº‹ä»¶çš„ç›®æ ‡å…ƒç´ 
      const index = el.dataset.index; // è·å–ç´¢å¼•
      items[index].done = !items[index].done; // é€šè¿‡å–åæ“ä½œæ¥åˆ‡æ¢å¯¹åº”å¾…åŠäº‹é¡¹çš„doneå±æ€§çš„çŠ¶æ€
      localStorage.setItem("items", JSON.stringify(items));
      populateList(items, itemsList);
    }

    // æ¸…ç©ºæŒ‰é’®
    function clearLocalStorage() {
      localStorage.removeItem("items");
      itemsList.innerHTML = "<li>æ­£åœ¨åŠ è½½å¾…åŠé¡¹...</li>"; // æ¸…ç©ºå¾…åŠäº‹é¡¹åˆ—è¡¨çš„æ˜¾ç¤º
    }

    // æ·»åŠ ç›‘å¬å™¨
    addItems.addEventListener("submit", addItem);
    itemsList.addEventListener("click", toggleDone);

    populateList(items, itemsList);
  </script>
</html>
.
